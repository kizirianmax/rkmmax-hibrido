{"version":3,"names":["cov_2lrp5g0s9c","actualCoverage","useEffect","useState","usePlan","f","plan","setPlan","s","loading","setLoading","window","b","ctrl","AbortController","load","raw","localStorage","getItem","email","trim","toLowerCase","res","fetch","headers","signal","ok","j","json","catch","aborted","onStorage","e","key","addEventListener","abort","removeEventListener"],"sources":["usePlan.js"],"sourcesContent":["// src/hooks/usePlan.js\nimport { useEffect, useState } from \"react\";\n\nexport default function usePlan() {\n  const [plan, setPlan] = useState(\"basic\");\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") {\n      setPlan(\"basic\");\n      setLoading(false);\n      return;\n    }\n\n    const ctrl = new AbortController();\n\n    const load = async () => {\n      const raw = window.localStorage.getItem(\"user_email\");\n      if (!raw) {\n        setPlan(\"basic\");\n        setLoading(false);\n        return;\n      }\n\n      const email = raw.trim().toLowerCase();\n      try {\n        const res = await fetch(\"/api/me-plan\", {\n          headers: { \"x-user-email\": email },\n          signal: ctrl.signal,\n        });\n        if (!res.ok) {\n          setPlan(\"basic\");\n          return;\n        }\n\n        const j = await res.json().catch(() => ({}));\n        setPlan(j.plan || \"basic\");\n      } catch {\n        if (ctrl.signal.aborted) return;\n        setPlan(\"basic\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    load();\n\n    const onStorage = (e) => {\n      if (e.key === \"user_email\") {\n        setLoading(true);\n        load();\n      }\n    };\n    window.addEventListener(\"storage\", onStorage);\n\n    return () => {\n      ctrl.abort();\n      window.removeEventListener(\"storage\", onStorage);\n    };\n  }, []);\n\n  return { plan, loading };\n}\n"],"mappings":"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","ignoreList":[]}