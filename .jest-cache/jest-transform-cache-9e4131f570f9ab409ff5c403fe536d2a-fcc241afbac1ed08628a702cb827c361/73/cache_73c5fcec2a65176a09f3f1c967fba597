7d092c47200be63586576b4864c16f83
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.globalCache = exports.SmartCache = void 0;
var _crypto = _interopRequireDefault(require("crypto"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
/**
 * ðŸ’° SMART CACHE - Cache inteligente para respostas
 * 
 * Implementa:
 * - Cache em memÃ³ria com TTL de 5 minutos
 * - LRU eviction policy
 * - Hash de mensagens para chave de cache
 * - Monitoramento de hit rate
 */

class SmartCache {
  constructor(maxSize = 100, ttl = 5 * 60 * 1000) {
    // 5 minutos
    this.cache = new Map();
    this.maxSize = maxSize;
    this.ttl = ttl;
    this.hits = 0;
    this.misses = 0;
  }

  /**
   * Gerar chave de cache baseada nas mensagens
   */
  generateKey(messages) {
    const content = JSON.stringify(messages);
    return _crypto.default.createHash('md5').update(content).digest('hex');
  }

  /**
   * Obter do cache
   */
  get(messages) {
    const key = this.generateKey(messages);
    const cached = this.cache.get(key);
    if (!cached) {
      this.misses++;
      return null;
    }

    // Verificar se expirou
    if (Date.now() > cached.expiresAt) {
      this.cache.delete(key);
      this.misses++;
      return null;
    }

    // Hit! Mover para o final (LRU)
    this.cache.delete(key);
    this.cache.set(key, cached);
    this.hits++;
    console.log(`ðŸ’° CACHE HIT! (${this.getHitRate()}% hit rate)`);
    return cached.value;
  }

  /**
   * Salvar no cache
   */
  set(messages, value) {
    const key = this.generateKey(messages);

    // Se cache estÃ¡ cheio, remover o mais antigo (LRU)
    if (this.cache.size >= this.maxSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, {
      value,
      expiresAt: Date.now() + this.ttl,
      createdAt: Date.now()
    });
  }

  /**
   * Limpar cache expirado
   */
  cleanup() {
    const now = Date.now();
    for (const [key, entry] of this.cache.entries()) {
      if (now > entry.expiresAt) {
        this.cache.delete(key);
      }
    }
  }

  /**
   * Obter estatÃ­sticas
   */
  getStats() {
    return {
      size: this.cache.size,
      maxSize: this.maxSize,
      hits: this.hits,
      misses: this.misses,
      hitRate: this.getHitRate(),
      totalRequests: this.hits + this.misses
    };
  }
  getHitRate() {
    const total = this.hits + this.misses;
    if (total === 0) return 0;
    return (this.hits / total * 100).toFixed(2);
  }

  /**
   * Limpar todo o cache
   */
  clear() {
    this.cache.clear();
    this.hits = 0;
    this.misses = 0;
  }
}

// InstÃ¢ncia global compartilhada
exports.SmartCache = SmartCache;
const globalCache = exports.globalCache = new SmartCache();

// Limpar cache expirado a cada 5 minutos
setInterval(() => {
  globalCache.cleanup();
}, 5 * 60 * 1000);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY3J5cHRvIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJTbWFydENhY2hlIiwiY29uc3RydWN0b3IiLCJtYXhTaXplIiwidHRsIiwiY2FjaGUiLCJNYXAiLCJoaXRzIiwibWlzc2VzIiwiZ2VuZXJhdGVLZXkiLCJtZXNzYWdlcyIsImNvbnRlbnQiLCJKU09OIiwic3RyaW5naWZ5IiwiY3J5cHRvIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsImdldCIsImtleSIsImNhY2hlZCIsIkRhdGUiLCJub3ciLCJleHBpcmVzQXQiLCJkZWxldGUiLCJzZXQiLCJjb25zb2xlIiwibG9nIiwiZ2V0SGl0UmF0ZSIsInZhbHVlIiwic2l6ZSIsImZpcnN0S2V5Iiwia2V5cyIsIm5leHQiLCJjcmVhdGVkQXQiLCJjbGVhbnVwIiwiZW50cnkiLCJlbnRyaWVzIiwiZ2V0U3RhdHMiLCJoaXRSYXRlIiwidG90YWxSZXF1ZXN0cyIsInRvdGFsIiwidG9GaXhlZCIsImNsZWFyIiwiZXhwb3J0cyIsImdsb2JhbENhY2hlIiwic2V0SW50ZXJ2YWwiXSwic291cmNlcyI6WyJjYWNoZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIPCfkrAgU01BUlQgQ0FDSEUgLSBDYWNoZSBpbnRlbGlnZW50ZSBwYXJhIHJlc3Bvc3Rhc1xuICogXG4gKiBJbXBsZW1lbnRhOlxuICogLSBDYWNoZSBlbSBtZW3Ds3JpYSBjb20gVFRMIGRlIDUgbWludXRvc1xuICogLSBMUlUgZXZpY3Rpb24gcG9saWN5XG4gKiAtIEhhc2ggZGUgbWVuc2FnZW5zIHBhcmEgY2hhdmUgZGUgY2FjaGVcbiAqIC0gTW9uaXRvcmFtZW50byBkZSBoaXQgcmF0ZVxuICovXG5cbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcblxuY2xhc3MgU21hcnRDYWNoZSB7XG4gIGNvbnN0cnVjdG9yKG1heFNpemUgPSAxMDAsIHR0bCA9IDUgKiA2MCAqIDEwMDApIHsgLy8gNSBtaW51dG9zXG4gICAgdGhpcy5jYWNoZSA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLm1heFNpemUgPSBtYXhTaXplO1xuICAgIHRoaXMudHRsID0gdHRsO1xuICAgIHRoaXMuaGl0cyA9IDA7XG4gICAgdGhpcy5taXNzZXMgPSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlcmFyIGNoYXZlIGRlIGNhY2hlIGJhc2VhZGEgbmFzIG1lbnNhZ2Vuc1xuICAgKi9cbiAgZ2VuZXJhdGVLZXkobWVzc2FnZXMpIHtcbiAgICBjb25zdCBjb250ZW50ID0gSlNPTi5zdHJpbmdpZnkobWVzc2FnZXMpO1xuICAgIHJldHVybiBjcnlwdG8uY3JlYXRlSGFzaCgnbWQ1JykudXBkYXRlKGNvbnRlbnQpLmRpZ2VzdCgnaGV4Jyk7XG4gIH1cblxuICAvKipcbiAgICogT2J0ZXIgZG8gY2FjaGVcbiAgICovXG4gIGdldChtZXNzYWdlcykge1xuICAgIGNvbnN0IGtleSA9IHRoaXMuZ2VuZXJhdGVLZXkobWVzc2FnZXMpO1xuICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuY2FjaGUuZ2V0KGtleSk7XG5cbiAgICBpZiAoIWNhY2hlZCkge1xuICAgICAgdGhpcy5taXNzZXMrKztcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIFZlcmlmaWNhciBzZSBleHBpcm91XG4gICAgaWYgKERhdGUubm93KCkgPiBjYWNoZWQuZXhwaXJlc0F0KSB7XG4gICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgdGhpcy5taXNzZXMrKztcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIEhpdCEgTW92ZXIgcGFyYSBvIGZpbmFsIChMUlUpXG4gICAgdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgICB0aGlzLmNhY2hlLnNldChrZXksIGNhY2hlZCk7XG4gICAgdGhpcy5oaXRzKys7XG5cbiAgICBjb25zb2xlLmxvZyhg8J+SsCBDQUNIRSBISVQhICgke3RoaXMuZ2V0SGl0UmF0ZSgpfSUgaGl0IHJhdGUpYCk7XG4gICAgcmV0dXJuIGNhY2hlZC52YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTYWx2YXIgbm8gY2FjaGVcbiAgICovXG4gIHNldChtZXNzYWdlcywgdmFsdWUpIHtcbiAgICBjb25zdCBrZXkgPSB0aGlzLmdlbmVyYXRlS2V5KG1lc3NhZ2VzKTtcbiAgICBcbiAgICAvLyBTZSBjYWNoZSBlc3TDoSBjaGVpbywgcmVtb3ZlciBvIG1haXMgYW50aWdvIChMUlUpXG4gICAgaWYgKHRoaXMuY2FjaGUuc2l6ZSA+PSB0aGlzLm1heFNpemUpIHtcbiAgICAgIGNvbnN0IGZpcnN0S2V5ID0gdGhpcy5jYWNoZS5rZXlzKCkubmV4dCgpLnZhbHVlO1xuICAgICAgdGhpcy5jYWNoZS5kZWxldGUoZmlyc3RLZXkpO1xuICAgIH1cblxuICAgIHRoaXMuY2FjaGUuc2V0KGtleSwge1xuICAgICAgdmFsdWUsXG4gICAgICBleHBpcmVzQXQ6IERhdGUubm93KCkgKyB0aGlzLnR0bCxcbiAgICAgIGNyZWF0ZWRBdDogRGF0ZS5ub3coKSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaW1wYXIgY2FjaGUgZXhwaXJhZG9cbiAgICovXG4gIGNsZWFudXAoKSB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIGVudHJ5XSBvZiB0aGlzLmNhY2hlLmVudHJpZXMoKSkge1xuICAgICAgaWYgKG5vdyA+IGVudHJ5LmV4cGlyZXNBdCkge1xuICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBPYnRlciBlc3RhdMOtc3RpY2FzXG4gICAqL1xuICBnZXRTdGF0cygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc2l6ZTogdGhpcy5jYWNoZS5zaXplLFxuICAgICAgbWF4U2l6ZTogdGhpcy5tYXhTaXplLFxuICAgICAgaGl0czogdGhpcy5oaXRzLFxuICAgICAgbWlzc2VzOiB0aGlzLm1pc3NlcyxcbiAgICAgIGhpdFJhdGU6IHRoaXMuZ2V0SGl0UmF0ZSgpLFxuICAgICAgdG90YWxSZXF1ZXN0czogdGhpcy5oaXRzICsgdGhpcy5taXNzZXMsXG4gICAgfTtcbiAgfVxuXG4gIGdldEhpdFJhdGUoKSB7XG4gICAgY29uc3QgdG90YWwgPSB0aGlzLmhpdHMgKyB0aGlzLm1pc3NlcztcbiAgICBpZiAodG90YWwgPT09IDApIHJldHVybiAwO1xuICAgIHJldHVybiAoKHRoaXMuaGl0cyAvIHRvdGFsKSAqIDEwMCkudG9GaXhlZCgyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaW1wYXIgdG9kbyBvIGNhY2hlXG4gICAqL1xuICBjbGVhcigpIHtcbiAgICB0aGlzLmNhY2hlLmNsZWFyKCk7XG4gICAgdGhpcy5oaXRzID0gMDtcbiAgICB0aGlzLm1pc3NlcyA9IDA7XG4gIH1cbn1cblxuLy8gSW5zdMOibmNpYSBnbG9iYWwgY29tcGFydGlsaGFkYVxuY29uc3QgZ2xvYmFsQ2FjaGUgPSBuZXcgU21hcnRDYWNoZSgpO1xuXG4vLyBMaW1wYXIgY2FjaGUgZXhwaXJhZG8gYSBjYWRhIDUgbWludXRvc1xuc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICBnbG9iYWxDYWNoZS5jbGVhbnVwKCk7XG59LCA1ICogNjAgKiAxMDAwKTtcblxuZXhwb3J0IHsgU21hcnRDYWNoZSwgZ2xvYmFsQ2FjaGUgfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBVUEsSUFBQUEsT0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQTRCLFNBQUFELHVCQUFBRSxDQUFBLFdBQUFBLENBQUEsSUFBQUEsQ0FBQSxDQUFBQyxVQUFBLEdBQUFELENBQUEsS0FBQUUsT0FBQSxFQUFBRixDQUFBO0FBVjVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQSxNQUFNRyxVQUFVLENBQUM7RUFDZkMsV0FBV0EsQ0FBQ0MsT0FBTyxHQUFHLEdBQUcsRUFBRUMsR0FBRyxHQUFHLENBQUMsR0FB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