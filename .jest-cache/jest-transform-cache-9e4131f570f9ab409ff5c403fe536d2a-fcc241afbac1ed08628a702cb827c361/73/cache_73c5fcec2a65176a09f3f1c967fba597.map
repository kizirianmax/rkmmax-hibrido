{"version":3,"names":["_crypto","_interopRequireDefault","require","e","__esModule","default","SmartCache","constructor","maxSize","ttl","cache","Map","hits","misses","generateKey","messages","content","JSON","stringify","crypto","createHash","update","digest","get","key","cached","Date","now","expiresAt","delete","set","console","log","getHitRate","value","size","firstKey","keys","next","createdAt","cleanup","entry","entries","getStats","hitRate","totalRequests","total","toFixed","clear","exports","globalCache","setInterval"],"sources":["cache.js"],"sourcesContent":["/**\n * ðŸ’° SMART CACHE - Cache inteligente para respostas\n * \n * Implementa:\n * - Cache em memÃ³ria com TTL de 5 minutos\n * - LRU eviction policy\n * - Hash de mensagens para chave de cache\n * - Monitoramento de hit rate\n */\n\nimport crypto from 'crypto';\n\nclass SmartCache {\n  constructor(maxSize = 100, ttl = 5 * 60 * 1000) { // 5 minutos\n    this.cache = new Map();\n    this.maxSize = maxSize;\n    this.ttl = ttl;\n    this.hits = 0;\n    this.misses = 0;\n  }\n\n  /**\n   * Gerar chave de cache baseada nas mensagens\n   */\n  generateKey(messages) {\n    const content = JSON.stringify(messages);\n    return crypto.createHash('md5').update(content).digest('hex');\n  }\n\n  /**\n   * Obter do cache\n   */\n  get(messages) {\n    const key = this.generateKey(messages);\n    const cached = this.cache.get(key);\n\n    if (!cached) {\n      this.misses++;\n      return null;\n    }\n\n    // Verificar se expirou\n    if (Date.now() > cached.expiresAt) {\n      this.cache.delete(key);\n      this.misses++;\n      return null;\n    }\n\n    // Hit! Mover para o final (LRU)\n    this.cache.delete(key);\n    this.cache.set(key, cached);\n    this.hits++;\n\n    console.log(`ðŸ’° CACHE HIT! (${this.getHitRate()}% hit rate)`);\n    return cached.value;\n  }\n\n  /**\n   * Salvar no cache\n   */\n  set(messages, value) {\n    const key = this.generateKey(messages);\n    \n    // Se cache estÃ¡ cheio, remover o mais antigo (LRU)\n    if (this.cache.size >= this.maxSize) {\n      const firstKey = this.cache.keys().next().value;\n      this.cache.delete(firstKey);\n    }\n\n    this.cache.set(key, {\n      value,\n      expiresAt: Date.now() + this.ttl,\n      createdAt: Date.now(),\n    });\n  }\n\n  /**\n   * Limpar cache expirado\n   */\n  cleanup() {\n    const now = Date.now();\n    for (const [key, entry] of this.cache.entries()) {\n      if (now > entry.expiresAt) {\n        this.cache.delete(key);\n      }\n    }\n  }\n\n  /**\n   * Obter estatÃ­sticas\n   */\n  getStats() {\n    return {\n      size: this.cache.size,\n      maxSize: this.maxSize,\n      hits: this.hits,\n      misses: this.misses,\n      hitRate: this.getHitRate(),\n      totalRequests: this.hits + this.misses,\n    };\n  }\n\n  getHitRate() {\n    const total = this.hits + this.misses;\n    if (total === 0) return 0;\n    return ((this.hits / total) * 100).toFixed(2);\n  }\n\n  /**\n   * Limpar todo o cache\n   */\n  clear() {\n    this.cache.clear();\n    this.hits = 0;\n    this.misses = 0;\n  }\n}\n\n// InstÃ¢ncia global compartilhada\nconst globalCache = new SmartCache();\n\n// Limpar cache expirado a cada 5 minutos\nsetInterval(() => {\n  globalCache.cleanup();\n}, 5 * 60 * 1000);\n\nexport { SmartCache, globalCache };\n"],"mappings":"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","ignoreList":[]}