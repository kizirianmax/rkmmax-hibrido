{"version":3,"names":["PerformanceMetrics","constructor","metrics","totalRequests","successfulRequests","failedRequests","timeouts","responseTimes","engineUsage","cacheStats","hits","misses","errors","recordRequest","data","success","timeout","responseTime","push","length","shift","engine","cached","undefined","error","message","timestamp","Date","toISOString","getResponseTimeStats","avg","min","max","p95","p99","sorted","sort","a","b","sum","reduce","acc","val","toFixed","Math","floor","getMetrics","responseTimeStats","total","cacheHitRate","requests","successful","failed","successRate","performance","avgResponseTime","minResponseTime","maxResponseTime","p95ResponseTime","p99ResponseTime","engines","cache","hitRate","recentErrors","slice","exportToSentry","Sentry","setContext","reset","exports","globalMetrics"],"sources":["metrics.js"],"sourcesContent":["/**\n * üìä PERFORMANCE METRICS - Monitoramento de performance\n * \n * Rastreia:\n * - Tempos de resposta\n * - Sele√ß√£o de engines\n * - Incidentes de timeout\n * - Cache hit rate\n * - Exporta para Sentry/PostHog\n */\n\nclass PerformanceMetrics {\n  constructor() {\n    this.metrics = {\n      totalRequests: 0,\n      successfulRequests: 0,\n      failedRequests: 0,\n      timeouts: 0,\n      responseTimes: [],\n      engineUsage: {},\n      cacheStats: { hits: 0, misses: 0 },\n      errors: [],\n    };\n  }\n\n  /**\n   * Registrar nova requisi√ß√£o\n   */\n  recordRequest(data) {\n    this.metrics.totalRequests++;\n    \n    if (data.success) {\n      this.metrics.successfulRequests++;\n    } else {\n      this.metrics.failedRequests++;\n    }\n\n    if (data.timeout) {\n      this.metrics.timeouts++;\n    }\n\n    if (data.responseTime) {\n      this.metrics.responseTimes.push(data.responseTime);\n      // Manter apenas √∫ltimas 1000 medi√ß√µes\n      if (this.metrics.responseTimes.length > 1000) {\n        this.metrics.responseTimes.shift();\n      }\n    }\n\n    if (data.engine) {\n      this.metrics.engineUsage[data.engine] = (this.metrics.engineUsage[data.engine] || 0) + 1;\n    }\n\n    if (data.cached !== undefined) {\n      if (data.cached) {\n        this.metrics.cacheStats.hits++;\n      } else {\n        this.metrics.cacheStats.misses++;\n      }\n    }\n\n    if (data.error) {\n      this.metrics.errors.push({\n        message: data.error,\n        timestamp: new Date().toISOString(),\n        engine: data.engine,\n      });\n      // Manter apenas √∫ltimos 100 erros\n      if (this.metrics.errors.length > 100) {\n        this.metrics.errors.shift();\n      }\n    }\n  }\n\n  /**\n   * Calcular estat√≠sticas de tempo de resposta\n   */\n  getResponseTimeStats() {\n    if (this.metrics.responseTimes.length === 0) {\n      return { avg: 0, min: 0, max: 0, p95: 0, p99: 0 };\n    }\n\n    const sorted = [...this.metrics.responseTimes].sort((a, b) => a - b);\n    const sum = sorted.reduce((acc, val) => acc + val, 0);\n    \n    return {\n      avg: (sum / sorted.length).toFixed(0),\n      min: sorted[0],\n      max: sorted[sorted.length - 1],\n      p95: sorted[Math.floor(sorted.length * 0.95)] || 0,\n      p99: sorted[Math.floor(sorted.length * 0.99)] || 0,\n    };\n  }\n\n  /**\n   * Obter todas as m√©tricas\n   */\n  getMetrics() {\n    const responseTimeStats = this.getResponseTimeStats();\n    const total = this.metrics.cacheStats.hits + this.metrics.cacheStats.misses;\n    const cacheHitRate = total > 0 ? ((this.metrics.cacheStats.hits / total) * 100).toFixed(2) : 0;\n\n    return {\n      requests: {\n        total: this.metrics.totalRequests,\n        successful: this.metrics.successfulRequests,\n        failed: this.metrics.failedRequests,\n        successRate: this.metrics.totalRequests > 0 \n          ? ((this.metrics.successfulRequests / this.metrics.totalRequests) * 100).toFixed(2) + '%'\n          : '0%',\n      },\n      performance: {\n        avgResponseTime: responseTimeStats.avg + 'ms',\n        minResponseTime: responseTimeStats.min + 'ms',\n        maxResponseTime: responseTimeStats.max + 'ms',\n        p95ResponseTime: responseTimeStats.p95 + 'ms',\n        p99ResponseTime: responseTimeStats.p99 + 'ms',\n        timeouts: this.metrics.timeouts,\n      },\n      engines: this.metrics.engineUsage,\n      cache: {\n        hits: this.metrics.cacheStats.hits,\n        misses: this.metrics.cacheStats.misses,\n        hitRate: cacheHitRate + '%',\n      },\n      recentErrors: this.metrics.errors.slice(-10), // √öltimos 10 erros\n    };\n  }\n\n  /**\n   * Exportar m√©tricas para Sentry\n   */\n  exportToSentry(Sentry) {\n    if (!Sentry) return;\n\n    const metrics = this.getMetrics();\n    Sentry.setContext('performance', metrics.performance);\n    Sentry.setContext('engines', metrics.engines);\n    Sentry.setContext('cache', metrics.cache);\n  }\n\n  /**\n   * Resetar m√©tricas\n   */\n  reset() {\n    this.metrics = {\n      totalRequests: 0,\n      successfulRequests: 0,\n      failedRequests: 0,\n      timeouts: 0,\n      responseTimes: [],\n      engineUsage: {},\n      cacheStats: { hits: 0, misses: 0 },\n      errors: [],\n    };\n  }\n}\n\n// Inst√¢ncia global\nconst globalMetrics = new PerformanceMetrics();\n\nexport { PerformanceMetrics, globalMetrics };\n"],"mappings":"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","ignoreList":[]}